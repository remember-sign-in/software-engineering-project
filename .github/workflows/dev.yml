on:
        push:
                branches:
                        - zxj-dev
                          
jobs:                     
        gunicorn-job:
               name: restart job
               runs-on: ubuntu-latest
               steps:
                      - uses: actions/checkout@v4
                      - name: install super
                        run: sudo apt install supervisor -y
                      - name: pip
                        run: pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple some-package


                      - name: copy
                        run: |
                            chmod u+x gunicorn_start
                            sudo cp fastapi-app /etc/nginx/sites-available/fastapi-app

                      - name: restart supervisor
                        run: |
                            ./gunicorn_start   
        nginx-job:
                name: nginx job
                runs-on: ubuntu-latest
                steps:
                      - name: start nginx
                        run: |
                            sudo ln -s /etc/nginx/sites-available/fastapi-app /etc/nginx/sites-enabled/
                            sudo nginx -t
                            sudo systemctl restart nginx
                            sudo supervisorctl restart JDQD
